!function(){"use strict";!function(){window.d2c=window.d2c||{};var c={};function u(e,t,r){var n=t.sources,o=t.layers;return function(t,r,e){void 0===r&&(r={});Object.keys(r).map(function(e){t.getSource(e)||t.addSource(e,r[e])})}(e,n),function(t,e,r){void 0===e&&(e=[]);return e.filter(function(e){return!t.getLayer(e.id)&&(r.before?t.addLayer(e,r.before):t.addLayer(e),!0)})}(e,o,r)}function s(e,t){var r=t.center,n=t.zoom;e.flyTo({center:r,zoom:n})}function a(e){var t,r=function(e){var t=Object.prototype.toString;if(e instanceof Element)return"element";return{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[t.call(e)]}(e);if("array"===r)t=[];else{if("object"!==r)return e;t={}}if("array"===r)for(var n=0,o=e.length;n<o;n++)t.push(a(e[n]));else if("object"===r)for(var i in e)t[i]=a(e[i]);return t}Object.defineProperty(c,"length",{get:function(e){return Object.keys(this).length}}),d2c.map.prototype.helper={version:"v0.23",description:"Fix -paint default property issue"},d2c.map.prototype.addStyle=function(o,e,i){var a=this;if(void 0===o&&(o=(new Date).getTime()+c.length),void 0===i&&(i={}),e)return"string"==typeof e?function(e){if(e&&"string"==typeof e)return fetch(e).then(function(e){return e.json()})}(e).then(function(r){u(a,r,i);var e=a.style.stylesheet,n=Object.keys(e.sources),t=r.layers.filter(function(t){return!e.layers.find(function(e){return t.id===e.id})});return c[o]={sources:Object.keys(r.sources).reduce(function(e,t){return t+="",n.find(function(e){return e===t})||(e[t]=r.sources[t]),e},{}),layers:t},a._loadedStyles=c,i.center&&s(a,r),r}).then(function(e){return i.onload&&i.onload(e)}):"object"==typeof e&&(c[o]={sources:e.sources,layers:u(this,e,i)},this._loadedStyles=c,i.center&&s(this,e),i.onload&&i.onload(e)),this},d2c.map.prototype.removeStyle=function(e){if(!e||"string"!=typeof e)throw new Error("Invalid parameter, id is required and must be string");return c[e]?(function(e,t){t.sources;var r=t.layers;!function(t,e){void 0===e&&(e=[]);e.map(function(e){t.getLayer(e.id)&&t.removeLayer(e.id)})}(e,r)}(this,c[e]),delete c[e],this):new Error(e+" is undefined")},d2c.map.prototype.getStyle=function(e){if(e&&"string"==typeof e)return c[e]?c[e]:new Error(e+" is undefined");throw new Error("Invalid parameter, id is required and must be string")},d2c.map.prototype.getStyles=function(){return c},d2c.map.prototype.addSprite=function(e,t){var r=this;void 0===t&&(t=function(){});var n={};if(!e||"string"!=typeof e)return new Error("Invalid parameter, url must be string");this.createVMap(e,function(e){n=a(e.style.imageManager.images),r.style.imageManager.images=Object.assign({},r.style.imageManager.images,n),t()})},d2c.map.prototype.addGlyphs=function(e,t){var r=this;void 0===t&&(t=function(){});var n={};if(!e||"string"!=typeof e)return new Error("Invalid parameter, url must be string");this.createVMap(e,function(e){n=a(e.style.glyphManager),r.style.glyphManager=n,t()})},d2c.map.prototype.createVMap=function(e,t){void 0===t&&(t=function(){});var r={version:8,sprite:e,sources:{},layers:[]},n=document.createElement("div");n.id=(new Date).getTime(),n.style.display="none",document.body.appendChild(n);var o=new d2c.map({container:n.id,style:r});o.on("load",function(){t(o),o.remove(),document.body.removeChild(n),o=null})},d2c.map.prototype.addSelect=function(o,i){void 0===i&&(i={activeColor:"red",type:"fill",property:"mapguid",multiple:!1}),i.property=i.property||"mapguid";var a=this;if(!o||"string"!=typeof o)throw new Error("id is required");if(!a.getLayer(o))throw new Error("layer "+o+" is not defined");var c={};i.type||(i.type="fill");var u=a.getPaintProperty(o,i.type+"-opacity");"number"!=typeof u&&(u=1);var s=a.getPaintProperty(o,i.type+"-color");function e(e){var t=a.queryRenderedFeatures(e.point,{layers:[o]});if(!(t.length<1)){var r=t[0].properties[i.property];if(!r)throw new Error("layer must have mapguid property");r in c?delete c[r]:(!i.multiple&&p(),c[r]=t[0]),n(),i.onselect&&i.onselect(t[0],c)}}function n(){if(0===Object.keys(c).length&&(c["no-one-selected"]=!0),i.activeOpacity){var e=Object.keys(c).map(function(e){return[e,i.activeOpacity]}),t={property:i.property,type:"categorical",stops:e,default:u.default?u.default:u};a.setPaintProperty(o,i.type+"-opacity",t)}if(i.activeColor){var r=Object.keys(c).map(function(e){return[e,i.activeColor]}),n={property:i.property,type:"categorical",stops:r,default:s.default?s.default:s};a.setPaintProperty(o,i.type+"-color",n)}delete c["no-one-selected"]}function p(e){if(e)delete c[e];else for(var t in c)c.hasOwnProperty(t)&&delete c[t]}return a.on("click",e),{remove:function(){p(),a.setPaintProperty(o,i.type+"-color",s),a.setPaintProperty(o,i.type+"-opacity",u)},start:function(){a.on("click",e)},stop:function(){a.off("click",e)},select:function(e){if(!e)throw new Error("layer must have mapguid property");e in c?delete c[e]:(!i.multiple&&p(),c[e]=e),n(),i.onselect&&i.onselect(e,c)},selectedFeature:c}}}()}();
