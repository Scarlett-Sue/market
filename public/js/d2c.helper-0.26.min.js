!function(){"use strict";function p(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&-1===t.indexOf(n)&&(r[n]=e[n]);return r}!function(){window.d2c=window.d2c||{};var s={},r=[];function u(e,t,r){var n=t.sources,o=t.layers;return function(t,r,e){void 0===r&&(r={});Object.keys(r).map(function(e){t.getSource(e)||t.addSource(e,r[e])})}(e,n),function(t,e,r){void 0===e&&(e=[]);return e.filter(function(e){return!t.getLayer(e.id)&&(r.before?t.addLayer(e,r.before):t.addLayer(e),!0)})}(e,o,r)}function l(e,t){var r=t.center,n=t.zoom;e.jumpTo({center:r,zoom:n})}function a(e){var t,r=function(e){var t=Object.prototype.toString;if(e instanceof Element)return"element";return{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[t.call(e)]}(e);if("array"===r)t=[];else{if("object"!==r)return e;t={}}if("array"===r)for(var n=0,o=e.length;n<o;n++)t.push(a(e[n]));else if("object"===r)for(var i in e)t[i]=a(e[i]);return t}Object.defineProperty(s,"length",{get:function(e){return Object.keys(this).length}}),d2c.map.prototype.helper={version:"v0.26",description:"Feat -addLevel --level manage"},d2c.map.prototype.addLevel=function(e,t){if(void 0===t&&(t={}),e&&"string"==typeof e){if(r.includes(e))throw new Error("Level "+e+" has been created");return r.push(e),t.before?this.addGeoLayer({id:e,type:"fill",paint:{"fill-opacity":0}},t.before):this.addGeoLayer({id:e,type:"fill",paint:{"fill-opacity":0}}),this.getLayer(e)}throw new Error("Level name is required and must be string")},d2c.map.prototype.removeLevel=function(e){if(!e||"string"!=typeof e)throw new Error("Level name is required and must be string");if(r.includes(e))return r.splice(r.indexOf(e),1),this.removeLayer(e),this.getLayer(e)},d2c.map.prototype.addStyle=function(i,e,a){var c=this;if(void 0===i&&(i=(new Date).getTime()+s.length),void 0===a&&(a={}),e){if("string"==typeof e)(function(e){if(e&&"string"==typeof e)return fetch(e).then(function(e){return e.json()})})(e).then(function(r){if(a.init){r.sources,r.layers;var e=p(r,["sources","layers"]);c.setStyle(e)}u(c,r,a);var n=c.style.stylesheet,o=Object.keys(n.sources),t=r.layers.filter(function(t){return!n.layers.find(function(e){return t.id===e.id})});return s[i]={sources:Object.keys(r.sources).reduce(function(e,t){return t+="",o.find(function(e){return e===t})||(e[t]=r.sources[t]),e},{}),layers:t},c._loadedStyles=s,a.center&&l(c,r),r}).then(function(e){return a.onload&&a.onload(e)});else if("object"==typeof e){if(a.init){e.sources,e.layers,p(e,["sources","layers"]);this.setStyle(e)}s[i]={sources:e.sources,layers:u(this,e,a)},this._loadedStyles=s,a.center&&l(this,e),a.onload&&a.onload(e)}return this}},d2c.map.prototype.removeStyle=function(e){if(!e||"string"!=typeof e)throw new Error("Invalid parameter, id is required and must be string");return s[e]?(function(e,t){t.sources;var r=t.layers;!function(t,e){void 0===e&&(e=[]);e.map(function(e){t.getLayer(e.id)&&t.removeLayer(e.id)})}(e,r)}(this,s[e]),delete s[e],this):new Error(e+" is undefined")},d2c.map.prototype.getStyle=function(e){if(e&&"string"==typeof e)return s[e]?s[e]:new Error(e+" is undefined");throw new Error("Invalid parameter, id is required and must be string")},d2c.map.prototype.getStyles=function(){return s},d2c.map.prototype.addSprite=function(e,t){var r=this;void 0===t&&(t=function(){});var n={};if(!e||"string"!=typeof e)return new Error("Invalid parameter, url must be string");this.createVMap(e,function(e){n=a(e.style.imageManager.images),r.style.imageManager.images=Object.assign({},r.style.imageManager.images,n),t()})},d2c.map.prototype.addGlyphs=function(e,t){var r=this;void 0===t&&(t=function(){});var n={};if(!e||"string"!=typeof e)return new Error("Invalid parameter, url must be string");this.createVMap(e,function(e){n=a(e.style.glyphManager),r.style.glyphManager=n,t()})},d2c.map.prototype.createVMap=function(e,t){void 0===t&&(t=function(){});var r={version:8,sprite:e,sources:{},layers:[]},n=document.createElement("div");n.id=(new Date).getTime(),n.style.display="none",document.body.appendChild(n);var o=new d2c.map({container:n.id,style:r});o.on("load",function(){t(o),o.remove(),document.body.removeChild(n),o=null})},d2c.map.prototype.addSelect=function(o,i){void 0===i&&(i={activeColor:"red",type:"fill",property:"mapguid",multiple:!1}),i.property=i.property||"mapguid";var a=this;if(!o||"string"!=typeof o)throw new Error("id is required");if(!a.getLayer(o))throw new Error("layer "+o+" is not defined");var c={};i.type||(i.type="fill");var s=a.getPaintProperty(o,i.type+"-opacity");"number"!=typeof s&&(s=1);var u=a.getPaintProperty(o,i.type+"-color");function e(e){var t=a.queryRenderedFeatures(e.point,{layers:[o]});if(!(t.length<1)){var r=t[0].properties[i.property];if(!r)throw new Error("layer must have mapguid property");r in c?delete c[r]:(!i.multiple&&l(),c[r]=t[0]),n(),i.onselect&&i.onselect(t[0],c)}}function n(){if(0===Object.keys(c).length&&(c["no-one-selected"]=!0),i.activeOpacity){var e=Object.keys(c).map(function(e){return[e,i.activeOpacity]}),t={property:i.property,type:"categorical",stops:e,default:s.default?s.default:s};a.setPaintProperty(o,i.type+"-opacity",t)}if(i.activeColor){var r=Object.keys(c).map(function(e){return[e,i.activeColor]}),n={property:i.property,type:"categorical",stops:r,default:u.default?u.default:u};a.setPaintProperty(o,i.type+"-color",n)}delete c["no-one-selected"]}function l(e){if(e)delete c[e];else for(var t in c)c.hasOwnProperty(t)&&delete c[t]}return a.on("click",e),{remove:function(){l(),a.setPaintProperty(o,i.type+"-color",u),a.setPaintProperty(o,i.type+"-opacity",s)},start:function(){a.on("click",e)},stop:function(){a.off("click",e)},select:function(e){if(!e)throw new Error("layer must have mapguid property");e in c?delete c[e]:(!i.multiple&&l(),c[e]=e),n(),i.onselect&&i.onselect(e,c)},selectedFeature:c}}}()}();
